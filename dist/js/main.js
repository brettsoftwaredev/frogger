"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}!function(){var t={},a=[];function n(e){if(t[e])return t[e];var n=new Image;n.onload=function(){t[e]=n,r()&&a.forEach(function(e){e()})},t[e]=!1,n.src=e}function r(){var e=!0;for(var n in t)t.hasOwnProperty(n)&&!t[n]&&(e=!1);return e}window.Resources={load:function(e){e instanceof Array?e.forEach(function(e){n(e)}):n(e)},get:function(e){return t[e]},onReady:function(e){a.push(e)},isReady:r}}();var level=document.querySelector("#level-counter").textContent,bestLevel=document.querySelector("#highest-level").textContent,levelVal=Number(level),bestLevelVal=Number(bestLevel),Enemy=function(e,n){this.x=e,this.y=n,this.speed=randomSpeed(50,75),this.sprite="dist/images/enemy-bug.png"};Enemy.prototype.update=function(e){var n=!0,t=!1,a=void 0;try{for(var r,s=allEnemies[Symbol.iterator]();!(n=(r=s.next()).done);n=!0)(Enemy=r.value).x<505?Enemy.x+=Enemy.speed*e:Enemy.x=-100}catch(e){t=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(t)throw a}}},Enemy.prototype.render=function(){ctx.drawImage(Resources.get(this.sprite),this.x,this.y)};var Player=function(){function a(e,n,t){_classCallCheck(this,a),this.x=e,this.y=n,this.sprite=t}return _createClass(a,[{key:"update",value:function(){-35==player.y&&(player.y=-36,levelUp(),setTimeout(function(){player.x=200,player.y=380},500))}},{key:"render",value:function(){ctx.drawImage(Resources.get(this.sprite),this.x,this.y)}},{key:"handleInput",value:function(e){"left"==e?this.x<505&&0<this.x&&(this.x+=-101):"right"==e?this.x<402&&-3<this.x&&(this.x+=101):"up"==e?this.y<381&&-36<this.y&&(this.y+=-83):"down"==e&&this.y<379&&-36<this.y&&(this.y+=83)}}]),a}(),allEnemies=[];allEnemies.push(new Enemy(randomPos(-100,500),214)),allEnemies.push(new Enemy(randomPos(-100,500),132)),allEnemies.push(new Enemy(randomPos(-100,500),48));var extraEnemies=[];for(x=1;x<1e3;x++)extraEnemies.push(new Enemy(randomPos(-100,500),214)),extraEnemies.push(new Enemy(randomPos(-100,500),132)),extraEnemies.push(new Enemy(randomPos(-100,500),48));var player=new Player(200,380,"dist/images/char-boy.png");function increaseDifficulty(){if(3<levelVal)if(allEnemies.length<6){allEnemies.push(extraEnemies[0]),extraEnemies.splice(0,1);for(var e=0;e<allEnemies.length;e++)(Enemy=allEnemies[e]).speed=randomSpeed(50,75)}else{allEnemies.push(extraEnemies[0]),extraEnemies.splice(0,1);for(var n=0;n<allEnemies.length;n++)(Enemy=allEnemies[n]).speed=randomSpeed(30,50)}else for(var t=0;t<allEnemies.length;t++)(Enemy=allEnemies[t]).speed*=1.2}function randomSpeed(e,n){return Math.random()*(n-e)+e}function randomPos(e,n){return Math.random()*(n-e)+e}function checkCollisions(){for(var e=0;e<allEnemies.length;e++){Enemy=allEnemies[e];var n=parseInt(Enemy.x,"."),t=parseInt(Enemy.y,".");n>player.x-75&&n<player.x+75&&t>player.y-80&&t<player.y+80&&resestGame()}}function resestGame(){for(player.x=200,player.y=380,x=1;x<levelVal;x++)extraEnemies.push(extraEnemies),allEnemies.splice(3,1);levelVal=1;for(var e=0;e<allEnemies.length;e++)(Enemy=allEnemies[e]).speed=randomSpeed(50,100);document.querySelector("#level-counter").textContent="1"}document.addEventListener("keyup",function(e){player.handleInput({37:"left",38:"up",39:"right",40:"down"}[e.keyCode])});var levelUp=function(){levelVal==bestLevelVal&&(bestLevelVal+=1),levelVal+=1,document.querySelector("#level-counter").textContent=levelVal.toString(),document.querySelector("#highest-level").textContent=bestLevelVal.toString(),increaseDifficulty()},Engine=function(e){var t,n=e.document,a=e.window,r=n.createElement("canvas"),s=r.getContext("2d");function i(){var n,e=Date.now();n=(e-t)/1e3,allEnemies.forEach(function(e){e.update(n)}),player.update(),checkCollisions(),function(){var e,n,t=["dist/images/water-block.png","dist/images/stone-block.png","dist/images/stone-block.png","dist/images/stone-block.png","dist/images/grass-block.png","dist/images/grass-block.png"];for(s.clearRect(0,0,r.width,r.height),e=0;e<6;e++)for(n=0;n<5;n++)s.drawImage(Resources.get(t[e]),101*n,83*e);allEnemies.forEach(function(e){e.render()}),player.render()}(),t=e,a.requestAnimationFrame(i)}r.width=505,r.height=586,n.body.appendChild(r),Resources.load(["dist/images/stone-block.png","dist/images/water-block.png","dist/images/grass-block.png","dist/images/enemy-bug.png","dist/images/char-boy.png"]),Resources.onReady(function(){t=Date.now(),i()}),e.ctx=s}(void 0);